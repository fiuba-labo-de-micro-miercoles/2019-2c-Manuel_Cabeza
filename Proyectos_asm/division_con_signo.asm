.include "m328pdef.inc"

.DEF DIVIDENDO = R16
.DEF DIVISOR = R17
.DEF COCIENTE = R18
.DEF RESTO = R19

.EQU NUMERADOR = 0x64
.EQU DENOMINADOR = 0x03

.MACRO SIGNO
	SBRS @0, 7
	RJMP FIN
	NEG @0 
	INC R20

FIN: NOP

.ENDMACRO

.CSEG 
	RJMP MAIN

MAIN:
	LDI DIVIDENDO, NUMERADOR
	LDI DIVISOR, DENOMINADOR
	CLR COCIENTE
	CLR RESTO
	RCALL DIVIDIR

TERMINO: RJMP TERMINO

DIVIDIR: 
	CPI DIVISOR, 0
	BREQ DIVISOR_NULO	
	SIGNO DIVIDENDO
	MOV R21, R20
	SIGNO DIVISOR 

OPERACION:
	INC COCIENTE
	SUB DIVIDENDO, DIVISOR
	BRCC OPERACION
	DEC COCIENTE
	ADD DIVIDENDO, DIVISOR
	MOV RESTO, DIVIDENDO

	SBRC R20,0
	NEG COCIENTE

	SBRC R21, 0
	NEG RESTO

	CLT
	RET

DIVISOR_NULO:
	SET
	RET
